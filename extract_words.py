from konlpy.tag import Okt
import re

def extract_sorted_unique_words(text):
    # 1. 텍스트 전처리
    text = text.replace('\xa0', ' ')  # 특수 공백 제거
    
    # 2. 불필요한 단어 리스트 (여행 관련 일반 용어들)
    stop_words = {
        # 일반적인 여행 용어
        '관광', '투어', '여행', '일정', '코스', '가이드', '투어', '관람', '체험', '방문',
        '출발', '도착', '이동', '경유', '귀국', '귀환', '체크인', '체크아웃', '휴식',
        '가이드미팅', '가이딩', '가이드안내', '현지가이드', '한국가이드', '인솔자',
        '일행', '단체', '승객', '고객', '여행객', '관광객', '탑승객',
        '예약', '예정', '준비', '대기', '집결', '모임', '미팅', '브리핑','왕복','신발','수속', '정상',
        
        # 시간 관련
        '아침', '점심', '저녁', '조식', '중식', '석식', '자유시간', '자유일정',
        '오전', '오후', '새벽', '야간', '당일', '익일', '전일',
        '시간', '분', '월', '일', '년', '자유일정', '자유관광', '자유시간', 
        '휴식시간', '관광시간', '이동시간', '오늘', '내일', '모레', '어제',
        
        # 교통 관련
        '버스', '열차', '기차', '비행기', '항공', '공항', '역', '터미널',
        '국제선', '국내선', '직항', '경유', '환승', '선박', '페리',
        '리무진', '밴', '택시', '지하철', '트램', '케이블카', '로프웨이',
        '주차장', '정류장', '항구', '부두', '선착장', '정거장', '차량',
        '기내', '수하물', '탑승', '운항', '교통',
        
        # 숙박 관련
        '숙소', '호텔', '동급', '투숙', '체크', '호텔조식', '호텔석식', 
        '룸타입', '싱글룸', '더블룸', '트윈룸', '객실', '룸', '스위트', 
        '디럭스', '스탠다드', '슈페리어',
        
        # 인원/신분 관련
        '성인', '아동', '유아', '개인', '일행', '한국인', '가이드', '기사',
        '부모', '동반',
        
        # 비용/요금 관련
        '요금', '만원', '억원', '할인', '팁', '입장료', '개인경비', '무료', '유료',
        
        # 식사 관련
        '식사', '식당', '레스토랑', '카페', '현지식', '한식', '중식', '양식', '일식',
        '뷔페', '메뉴', '식사시간', '음료', '커피', '디저트', '특식',
        
        # 예약/계약 관련
        '예약', '계약', '문의', '견적', '패널티', '가능', '예약번호', '바우처',
        '영수증', '현금', '카드', '환전',
        
        # 쇼핑 관련
        '면세점', '아울렛', '백화점', '쇼핑센터', '마트', '상점', '매장',
        '기념품', '특산품', '선물', '쇼핑시간',
        
        # 시설 관련
        '로비', '프론트', '리셉션', '안내소', '인포메이션', '화장실', '매표소',
        '출구', '입구', '엘리베이터', '에스컬레이터', '편의점', '안내데스크',
        
        # 상태/조건 관련
        '유효', '필수', '별도', '가능', '허가', '조건', '포함', '불포함', 
        '기본', '추가', '선택', '필수',
        
        # 위치/방향 관련
        '현지', '위치', '동', '서', '남', '북', '중앙', 
        '근처', '부근', '인근', '주변', '좌측', '우측', '전방', '후방', 
        '맞은편', '건너편', '인접', '외곽', '중심부', '구역', '지구', '단지', '구간',
        
        # 행동/상태 관련
        '체험', '참여', '사용', '착용', '출입', '구경', '산책', '쇼핑', 
        '촬영', '탑승', '하차', '승차',
        
        # 날씨/계절 관련
        '우천', '맑음', '흐림', '강우', '폭설', '기온', '날씨',
        '봄', '여름', '가을', '겨울', '성수기', '비수기',
        
        # 시설 상태/특성
        '신축', '리모델링', '공사중', '폐장', '휴장', '성수기', '혼잡',
        '만실', '여유', '쾌적', '청결', '냉난방',
        
        # 특별 표현
        'remark', '특전', '특징', '품격', '옵션', '주의사항', '안내사항', 
        '참고사항', '특이사항', '공지사항',
        
        # 조사/어미
        '니다', '세요', '하는', '있는', '하여', '리는', '어야',
        
        # 수량/기준 관련
        '기준', '미만', '최소', '인원', '전체',
        
        # 기타 용어
        '상품', '상기', '변경', '포함', '합산', '복장', '인센',
        '출국', '양국', '해발', '조업', '지정된', '없이',
        '준비물', '복장', '안전', '보험', '비상', '긴급',
        '픽업', '샌딩', '짐', '캐리어', '여권', '비자', '티켓',
        
        # 수식어구
        '사정에', '옷과', '세워진', '요망',
        
        # 형용사적 표현
        '유명한', '아름다운', '웅장한', '특별한', '전통적인', '현대적인'
    }
      # 장소명의 일부로 자주 사용되는 단어들은 불용어에서 제외
    location_terms = {
        '플라자', '타워', '센터', '파크', '몰', '마트', '빌딩', '스퀘어',
        '시티', '타운', '월드', '랜드', '마을', '거리', '광장', '공원'
    }
    
    # 불용어에서 장소 관련 단어 제외
    stop_words = stop_words - location_terms
    
    # 3. KoNLPy 초기화
    okt = Okt()
    
    # 4. 텍스트를 쉼표, 공백, 줄바꿈으로 분리
    words = re.split('[,\s\n]+', text)
    
    # 5. 형태소 분석 및 필터링
    result_words = set()
    for word in words:
        if not word or len(word) <= 1:  # 빈 문자열이거나 한 글자인 경우 제외
            continue
            
        # 먼저 형태소 분석으로 조사/부사/형용사 제거
        pos_tags = okt.pos(word)
        filtered_word = ''
        for morpheme, pos in pos_tags:
            # 조사, 부사, 형용사가 아닌 경우에만 단어 조합
            if pos not in ['Josa', 'Adjective', 'Adverb']:
                filtered_word += morpheme
        
        # 특수문자와 구두점 제거
        filtered_word = re.sub(r'[.!?~\(\)\'\"°\[\]\{\},;:]', '', filtered_word)
        
        # 필터링된 단어가 있고 한 글자보다 긴 경우에만 다음 단계로
        if filtered_word and len(filtered_word) > 1:
            # 그 다음 불용어와 정확히 일치하는 경우 제외
            if filtered_word not in stop_words:
                result_words.add(filtered_word)
    
    # 6. 정렬하여 리스트로 반환
    return ','.join(sorted(list(result_words)))
# 사용 예시
if __name__ == "__main__":
    sample_text = """
    서울 롯데호텔에서 조식 후 경복궁, 창덕궁 관광.
    명동에서 점심식사와 자유시간.
    남산서울타워 방문 후 저녁은 동대문디자인플라자에서.
    아름다운 경치와 맛있는 식사.
    """
    
    result = extract_sorted_unique_words(sample_text)
    print("추출된 장소:", result)